from flask import Flask, render_template, request, redirect, url_for, flash
import pymysql

app = Flask(__name__)
app.secret_key = "clave_secreta"

def conectar_db():
    return pymysql.connect(
        host="localhost",
        user="root",
        password="root",
        database="asistencia_db",  # nombre correcto según tu .sql
        port=3307                  # tu MySQL corre en 3307 según el dump
    )

@app.route("/")
def index():
    return render_template("registro.html")

@app.route("/registrar_usuario", methods=["POST"])
def registrar_usuario():
    usuario = request.form["usuario"]
    password = request.form["password"]
    confirm_password = request.form["confirm_password"]

    if password != confirm_password:
        flash("Las contraseñas no coinciden ⚠️")
        return redirect(url_for("index"))

    try:
        conexion = conectar_db()
        with conexion.cursor() as cursor:
            sql = "INSERT INTO usuarios (usuario, password) VALUES (%s, %s)"
            cursor.execute(sql, (usuario, password))
            conexion.commit()
            flash("Usuario registrado con éxito ✅")
    except Exception as e:
        flash(f"Error al registrar usuario: {e}")
    finally:
        if conexion:
            conexion.close()
    
    return redirect(url_for("index"))

if __name__ == "__main__":
    app.run(debug=True)